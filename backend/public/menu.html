<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Menú Principal - KiroGlam</title>
</head>
<body>
  <div class="menu-container">
    <!-- Información del usuario autenticado -->
    <div class="user-info mb-3" style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 20px;">
      <img class="user-photo" src="" alt="Foto" style="width: 50px; height: 50px; border-radius: 50%; display: none; margin-right: 10px;">
      <div style="display: inline-block; vertical-align: middle;">
        <div class="user-name" style="font-weight: bold; color: #2e7d32;">Cargando...</div>
        <div class="user-email" style="font-size: 0.9em; color: #666;">Verificando autenticación...</div>
      </div>
    </div>
    
    <h2 class="text-center mb-4" style="color:#8d5c5c; font-weight:bold; letter-spacing:1px; font-size: 2.5rem;">
      <i class="fas fa-store-alt"></i> KIRO GLAM
    </h2>
    <div class="menu-buttons">
      <a href="inventario.html" class="btn btn-menu">
        <i class="fas fa-boxes"></i> INVENTARIO
      </a>
      <a href="vender.html" class="btn btn-menu">
        <i class="fas fa-shopping-cart"></i> VENDER
      </a>
    
      <button class="btn btn-menu logout-btn" style="background: #dc3545; color: white;">
        <i class="fas fa-sign-out-alt"></i> CERRAR SESIÓN
      </button>
    </div>
  </div>
  
  <!-- Incluir el manager de autenticación -->
  <script src="JS/auth-manager.js"></script>
  <script>
    // El auth-manager se encarga automáticamente de verificar la autenticación OAuth
    // Removida verificación obsoleta de localStorage que causaba bucles
    
    // Crear modal de confirmación bonito
    function crearModalConfirmacion() {
      const modal = document.createElement('div');
      modal.innerHTML = `
        <div id="modal-confirmacion-logout" style="
          display: none;
          position: fixed;
          z-index: 9999;
          left: 0; top: 0; width: 100vw; height: 100vh;
          background: rgba(0,0,0,0.3);
          justify-content: center;
          align-items: center;
        ">
          <div style="
            background: #fff6f6;
            border-radius: 16px;
            box-shadow: 0 4px 16px #e2cfcf;
            padding: 32px 24px;
            max-width: 380px;
            min-width: 300px;
            text-align: center;
          ">
            <div style="
              width: 60px;
              height: 60px;
              background: #fff3cd;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              margin: 0 auto 20px auto;
              box-shadow: 2px 4px 8px #e2cfcf;
            ">
              <i class="fas fa-question-circle fa-2x" style="color: #856404;"></i>
            </div>
            <h4 style="color: #8d5c5c; font-weight: bold; font-size: 1.3rem; margin-bottom: 10px;">Cerrar Sesión</h4>
            <p style="color: #6d4c4c; font-size: 1rem; margin-bottom: 25px;">¿Está seguro de que desea cerrar sesión?</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
              <button id="btn-cancelar-logout" style="
                background: #6c757d;
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                font-weight: bold;
                border: none;
                cursor: pointer;
                min-width: 80px;
              ">Cancelar</button>
              <button id="btn-confirmar-logout" style="
                background: #dc3545;
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                font-weight: bold;
                border: none;
                cursor: pointer;
                min-width: 80px;
              ">Cerrar Sesión</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Event listeners
      document.getElementById('btn-cancelar-logout').addEventListener('click', () => {
        document.getElementById('modal-confirmacion-logout').style.display = 'none';
      });
      
      document.getElementById('btn-confirmar-logout').addEventListener('click', () => {
        localStorage.removeItem('token');
        localStorage.removeItem('username');
        window.location.href = 'index.html';
      });
      
      // Cerrar al hacer click fuera del modal
      document.getElementById('modal-confirmacion-logout').addEventListener('click', (e) => {
        if (e.target.id === 'modal-confirmacion-logout') {
          document.getElementById('modal-confirmacion-logout').style.display = 'none';
        }
      });
    }
    
    // Crear el modal al cargar la página
    crearModalConfirmacion();
    
    // Función para cerrar sesión
    function cerrarSesion() {
      document.getElementById('modal-confirmacion-logout').style.display = 'flex';
    }
  </script>
</body>
</html>
