@startuml KiroGlam OAuth Flow
!theme aws-orange

title KiroGlam - Flujo de Autenticación OAuth 2.0

actor "Usuario" as user
participant "Browser" as browser
participant "Render App\n(bazarxd.onrender.com)" as app
participant "Google OAuth" as google
participant "MongoDB Atlas" as db

== Inicio de Sesión ==
user -> browser: Accede a /login.html
browser -> app: GET /login.html
app -> browser: Página de login
browser -> user: Muestra opciones de login

user -> browser: Click "Continuar con Google"
browser -> app: GET /auth/google
app -> google: Redirige con client_id & scopes

== Autenticación Google ==
google -> user: Pantalla de autorización
user -> google: Autoriza aplicación
google -> app: Callback con authorization code
app -> google: Intercambia code por access_token
google -> app: Retorna user profile

== Creación de Sesión ==
app -> app: Serializa usuario en sesión
app -> browser: Redirige a /menu.html
note right: Session cookie con\nkiroglam.sid establecida

== Verificación de Estado ==
browser -> app: GET /menu.html
app -> app: Middleware verifica sesión
app -> browser: Página del menú
browser -> app: AJAX GET /auth/user
app -> browser: JSON con datos del usuario

== Operaciones CRUD ==
user -> browser: Navega a inventario
browser -> app: GET /inventario.html
app -> browser: Página de inventario

browser -> app: AJAX GET /api/carteras
app -> db: Query carteras collection
db -> app: Retorna documentos
app -> browser: JSON con productos

user -> browser: Edita/elimina producto
browser -> app: PUT/DELETE /api/carteras/:id
app -> db: Update/Delete operation
db -> app: Confirmación
app -> browser: Status response

@enduml
