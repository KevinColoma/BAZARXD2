@startuml KiroGlam Architecture
!define RECTANGLE class

skinparam backgroundColor #f8f9fa
skinparam componentStyle rectangle
skinparam monochrome false
skinparam shadowing false

' Estilos personalizados
skinparam component {
    BackgroundColor #e3f2fd
    BorderColor #1976d2
    FontColor #0d47a1
}

skinparam cloud {
    BackgroundColor #fff3e0
    BorderColor #f57c00
    FontColor #e65100
}

skinparam database {
    BackgroundColor #e8f5e8
    BorderColor #388e3c
    FontColor #1b5e20
}

skinparam actor {
    BackgroundColor #fce4ec
    BorderColor #c2185b
    FontColor #880e4f
}

title KiroGlam - Sistema de Gestión de Bazar\nArquitectura en la Nube

' Actores
actor "Usuario Móvil" as mobile #lightblue
actor "Usuario Desktop" as desktop #lightgreen
actor "Administrador" as admin #orange

' Servicios en la nube
cloud "Google Cloud Services" as google_cloud {
    component "Google OAuth 2.0" as oauth #ffeb3b
    note right of oauth
        - Client ID/Secret
        - Autenticación segura
        - Perfil de usuario
    end note
}

cloud "Render.com" as render_cloud {
    component "Frontend & Backend" as webapp {
        component "Express.js Server" as express #4caf50
        component "Static Files" as static #81c784
        component "OAuth Routes" as auth_routes #a5d6a7
        component "API Routes" as api_routes #c8e6c9
        
        note right of express
            **Puerto: 4000**
            **Node.js v18+**
            **Framework: Express.js**
        end note
    }
    
    note bottom of render_cloud
        **Deployment:**
        - Auto-deploy desde GitHub
        - HTTPS automático
        - Variables de entorno
        - Logs en tiempo real
    end note
}

cloud "MongoDB Atlas" as mongo_cloud {
    database "MongoDB Cluster" as mongodb #4db6ac
    component "Collections" as collections {
        RECTANGLE "Admin" as admin_col
        RECTANGLE "Cartera" as cartera_col
    }
    
    note right of mongodb
        **Cloud Database:**
        - Cluster M0 (Free Tier)
        - Auto-scaling
        - Backup automático
        - SSL/TLS encryption
    end note
}

cloud "GitHub" as github_cloud {
    component "Repository" as repo #6c757d
    component "CI/CD Pipeline" as cicd #868e96
    
    note right of repo
        **Repositorio:**
        - bazarxd2
        - Branch: main
        - Auto-deploy a Render
    end note
}

' Tecnologías Frontend
component "Frontend Stack" as frontend_stack {
    component "HTML5/CSS3" as html_css #ff9800
    component "Bootstrap 4.6" as bootstrap #7b1fa2
    component "JavaScript ES6+" as javascript #ffc107
    component "Font Awesome" as fontawesome #3f51b5
    
    note bottom of frontend_stack
        **Características:**
        - Responsive Design
        - PWA Ready
        - Single Page Components
    end note
}

' Flujo de datos y conexiones
mobile -down-> render_cloud : "HTTPS (443)"
desktop -down-> render_cloud : "HTTPS (443)"
admin -down-> render_cloud : "HTTPS (443)"

render_cloud -right-> google_cloud : "OAuth Flow\nHTTPS/API"
render_cloud -down-> mongo_cloud : "MongoDB Connection\nSRV Protocol"
github_cloud -right-> render_cloud : "Auto Deploy\nWebhook"

' Detalles de componentes internos
express -down-> static : "Serve Static Files"
express -down-> auth_routes : "/auth/*"
express -down-> api_routes : "/api/*"

auth_routes -up-> oauth : "OAuth Integration"
api_routes -down-> mongodb : "CRUD Operations"

mongodb -down-> collections
collections -down-> admin_col
collections -down-> cartera_col

' Especificaciones técnicas
note top of webapp
    **Tech Stack:**
    - **Backend:** Node.js + Express.js
    - **Autenticación:** Passport.js + Google OAuth
    - **Sesiones:** express-session
    - **CORS:** Habilitado
    - **Middleware:** JSON parser, Static files
end note

note bottom of frontend_stack
    **Funcionalidades:**
    - **Inventario:** CRUD completo
    - **Ventas:** Gestión de stock
    - **Facturación:** PDF generation
    - **Autenticación:** Google OAuth
    - **Responsive:** Mobile-first
end note

' URLs y endpoints
note bottom of render_cloud
    **URLs Principales:**
    - https://bazarxd.onrender.com/
    - https://bazarxd.onrender.com/login.html
    - https://bazarxd.onrender.com/menu.html
    - https://bazarxd.onrender.com/inventario.html
    - https://bazarxd.onrender.com/api/carteras
    - https://bazarxd.onrender.com/auth/google
end note

' Variables de entorno
note left of render_cloud
    **Environment Variables:**
    - NODE_ENV=production
    - GOOGLE_CLIENT_ID
    - GOOGLE_CLIENT_SECRET
    - MONGO_URI
    - SESSION_SECRET
end note

@enduml
